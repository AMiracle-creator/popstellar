{
	"$schema": "http://json-schema.org/draft/2019-09/schema#",
	"$id": "http://pop2020.dedis.ch/generic.json",
	"title": "Match a custom JsonRpc 2.0 message",
	"description": "Match a client query or a positive or negative server answer",

	"oneOf": [
		{	
			"description": "Match a client query",
			"type": "object",
			"allOf": [
				{
					"maxProperties": 4, 
					"$comment": "Note: can't use \"additionalProperties: false\" due to \"allOf\""
				}, 
				{
					"properties": {
						"jsonrpc": { "const": "2.0" }
					},
					"required": ["jsonrpc"]
				}, {
					"oneOf": [
						{ "$ref": "method/subscribe.json" },
						{ "$ref": "method/unsubscribe.json" },
						{ "$ref": "method/catchup.json" },
						{ "$ref": "method/broadcast.json" },
						{ "$ref": "method/publish.json" }
					]
				}
			]
		}, 

		{
			"description": "Match a positive or negative server answer",
			"type": "object",
			"properties": {
				"jsonrpc": { "description": "[String] JsonRpc version", "const": "2.0", "$comment": "should always be \"2.0\"" },
				"result": { 
					"description": "In case of positive answer, result of the client query",
					"oneOf": [
						{ "$ref": "answer/positiveAnswerGeneral.json" },
						{ "$ref": "answer/positiveAnswerCatchup.json" }
					],
					"$comment": "Note: this field is absent if the answer is negative"
				},
				"error": {
					"description": "In case of negative answer, error generated by the client query",
					"$ref": "answer/negativeAnswer/error.json"
				},
				"id": { "type": "integer" }
			},
			"additionalProperties": false,
			"allOf": [
				{ "required": ["jsonrpc", "id"] },
				{ 
					"oneOf": [
						{ "required": ["result"] },
						{ "required": ["error"] }
					] 
				}
			],
			"$comment": "Note: required fields: (\"jsonrpc\" \\and (\"result\" \\or \"error\") \\and \"id\")"
		}
	]
}
